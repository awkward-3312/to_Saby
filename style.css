:root{
  --bg1:#ffeff6; /* Fondo suave */
  --bg2:#ffe4ea; /* Degradado */
  --rose:#ff6b88; /* Rosa principal */
  --rose-dark:#e75575; /* Rosa oscuro */
  --ink:#333; /* Texto */
  --paper:#fffaf5; /* Papel */
  --shadow:0 20px 50px rgba(0,0,0,.12);
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  background: radial-gradient(1200px 600px at 50% -10%, var(--bg2), var(--bg1) 60%);
  color:var(--ink);
  overflow-x:hidden;
  font-size:clamp(15px,3.5vw,18px);
}

.stage{min-height:100%; display:grid; place-items:center; padding:clamp(20px,6vw,40px)}

/* Tarjeta / Sobre */
.envelope-wrap{position:relative; width:min(420px, 86vw); aspect-ratio:3/2; perspective:1200px;}
.hint{position:absolute; width:100%; text-align:center; top:-36px; font-size:clamp(12px,3vw,14px); opacity:.8}

.envelope{
  position:relative; width:100%; height:100%;
  border-radius:16px; box-shadow:var(--shadow);
  transform-style:preserve-3d; cursor:pointer
}

/* Capas (z-index) */
.envelope .back{
  position:absolute; inset:0;
  background:linear-gradient(180deg,#fff, #ffe9ee);
  border:2px solid #ffd1db; border-radius:16px;
  z-index:1;
}
.pocket{
  position:absolute; inset:0;
  border-radius:16px;
  background:linear-gradient(180deg,#fff5f7,#ffe0e7);
  clip-path: polygon(0 0,100% 0,100% 100%,0 100%, 50% 58%);
  border:2px solid #ffd1db;
  z-index:2;
}
.flap{
  position:absolute; inset:0;
  transform-origin:top;
  transform:rotateX(0deg);
  transition:transform 900ms cubic-bezier(.2,.8,.2,1);
  border-radius:16px;
  background:linear-gradient(180deg,#ffd5df,#ffc0ce);
  clip-path: polygon(0 0, 100% 0, 50% 58%);
  box-shadow:inset 0 -10px 40px rgba(0,0,0,.05);
  z-index:4;
}

/* Carta (plegada) — oculta al inicio */
.letter{
  position:absolute; left:50%; bottom:14%;
  width:86%; height:58%;
  background:var(--paper); border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
  z-index:3;
  transform:translateX(-50%) translateY(30%);
  opacity:0; pointer-events:none;
  transition:
    transform 900ms cubic-bezier(.2,.8,.2,1),
    height 800ms cubic-bezier(.2,.8,.2,1),
    opacity 500ms ease;
  overflow:hidden; cursor:pointer;
}

.letter-head{
  padding:18px 20px; border-bottom:1px dashed #f0d5d5;
  background:linear-gradient(180deg,#fff,#fff7f2);
  font-weight:600; color:#c24a64;
  display:flex; align-items:center; gap:8px
}
.stamp{
  margin-left:auto; width:38px; height:30px; border-radius:6px;
  background: conic-gradient(from 0deg, #ff8fb3, #ffd1db, #ffb3c7, #ff8fb3);
  opacity:.8
}

.letter-body{
  padding:18px 20px 60px 20px; line-height:1.6;
  max-height:0; overflow:hidden;
  transition:max-height 900ms cubic-bezier(.2,.8,.2,1);
  font-size:clamp(14px,3.5vw,16px);
}
.letter-body p{margin:.25rem 0}

.cta{
  display:inline-block; margin-top:10px; background:var(--rose); color:white;
  border:none; padding:10px 14px; border-radius:999px; font-weight:700; cursor:pointer;
  box-shadow:0 6px 14px rgba(255,107,136,.3); touch-action:manipulation
}
.cta:active{transform:translateY(1px)}

/* Estado abierto */
.envelope.open .flap{
  transform:rotateX(-175deg);
  z-index:1; /* manda la solapa atrás al abrir */
}
.envelope.lift .letter{
  transform:translateX(-50%) translateY(-60%) rotateX(0);
  opacity:1;
  pointer-events:auto;
}

/* Carta expandida */
.letter.expanded{ height:90% }
.letter.expanded .letter-body{ max-height:1000px }

/* Mensajes dinámicos */
.messages{
  position:fixed; inset:0;
  display:grid; place-items:center;
  pointer-events:none
}
.message-chip{
  background:#ffffffea; backdrop-filter: blur(6px);
  border:1px solid #ffd9e3; padding:12px 16px; border-radius:12px;
  box-shadow:var(--shadow); font-size:18px; animation:pop .35s ease forwards
}
@keyframes pop{from{transform:scale(.9); opacity:0} to{transform:scale(1); opacity:1}}

/* Partículas (flores, corazones, confeti) */
.particle{
  position:fixed; top:-40px;
  font-size:24px; will-change:transform, opacity;
  animation:fall linear forwards;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg); opacity:.9}
}

/* Botonera final */
.final{display:flex; gap:12px; margin-top:12px}
.btn{
  background:var(--rose); color:#fff; border:none;
  padding:10px 18px; border-radius:12px; font-weight:700;
  cursor:pointer; box-shadow:0 8px 18px rgba(255,107,136,.35);
  touch-action:manipulation
}
.btn.alt{background:#ffd1db; color:#c24a64}

/* Footer sutil */
.footer{position:fixed; bottom:10px; left:0; right:0; text-align:center; font-size:12px; opacity:.6}

/* Responsivo */
@media (max-width:480px){
  .envelope-wrap{width:90vw}
  .letter.expanded{height:96%}
}
